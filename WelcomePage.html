<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <button id="btnAceptar">Aceptar</button>
    <button id="btnCookie">Inyectar cookie</button>
    <h1 style="display: none;" id="message">Ya tienes permisos de almacenamiento</h1>




    <script>


    const REDIRECT = GetParam();
      function GetParam(){
        const urlParams = new URLSearchParams(window.location.search);

        const url = urlParams.get('backUrl');

        return url;
      }


        document.addEventListener('DOMContentLoaded', function() {
        
            var message = document.getElementById("message");
        document.hasStorageAccess().then(
          function(hasAccess) {
            if (hasAccess) {
              message.style.display = "block";
            } else {
                message.style.display = "none";
                SendMessage(window.location.href)
            }
          },
          function(error) {
            console.error("Error al verificar el acceso al almacenamiento: ", error);
          }
        );
        });
        
        document.getElementById('btnCookie').addEventListener('click', function() {
             SetCookie();



             document.hasStorageAccess().then(
          function(hasAccess) {
            if (hasAccess) {
             console.log("cookie inyectada")
            } else {
              console.log("cookie no inyectada")
            }
          },
          function(error) {
            console.error("Error al verificar el acceso al almacenamiento: ", error);
          }
        );

             
            });
   
         document.getElementById('btnAceptar').addEventListener('click', function() {
              document.requestStorageAccess().then(
                function() {
                  console.log("Acceso a las cookies concedido");
            
                  SetCookie();
                  SendMessage("cookies_access_granted")
 
                },
                function() {
                  console.log("Acceso a las cookies denegado");
                  SendMessage("cookies_access_denied")
                }
              );
            });
        
        
            function SetCookie(){
                console.log("cookie inyectada")
                document.cookie = "testcookie=testValue; path=/; SameSite=None; Secure";
            }
        
        


            function SendMessage(messagePost){
              window.parent.postMessage({ message: messagePost }, "*");
            }
         
        
        
        
        
        </script>

</body>




</html>


